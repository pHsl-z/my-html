<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>åœ¨çº¿HTML5ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* å…è®¸ç¼–è¾‘å™¨å†…å®¹å¯é€‰ */
        .code-editor, .preview-frame {
            -webkit-user-select: text;
            user-select: text;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
            -webkit-text-size-adjust: 100%;
            /* é˜²æ­¢ iOS Safari åœ°å€æ æ”¶èµ·æ—¶çš„è·³åŠ¨ */
            min-height: -webkit-fill-available;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --vh: 1vh;
        }

        .container {
            display: flex;
            height: 100vh; /* å›é€€å€¼ */
            height: calc(var(--vh, 1vh) * 100); /* ä½¿ç”¨è®¡ç®—çš„è§†å£é«˜åº¦ */
            width: 100vw;
            background: #161616;
            border: 1px solid #2a2a2a;
            margin: 0;
            overflow: hidden;
            position: relative;
            /* é˜²æ­¢ iOS æ©¡çš®ç­‹æ•ˆæœ */
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            border-right: 1px solid #2a2a2a;
            min-width: 0;
            position: relative;
        }

        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            min-width: 0;
            position: relative;
        }

        .panel-header {
            background: #1a1a1a;
            color: #ffffff;
            padding: 16px 24px;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2a2a2a;
            letter-spacing: 0.5px;
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-title .btn-link {
            background: none;
            border: none;
            color: inherit;
            font: inherit;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            transition: opacity 0.2s ease;
        }
        
        .panel-title .btn-link:hover {
            opacity: 0.8;
        }
        
        .panel-title .btn-link:active {
            opacity: 0.6;
        }

        .code-editor {
            flex: 1;
            border: none;
            padding: 24px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            background: #0d0d0d;
            color: #e6e6e6;
            caret-color: #ffffff;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre;
            tab-size: 4;
            -webkit-overflow-scrolling: touch;
            -webkit-appearance: none;
            appearance: none;
            border-radius: 0;
        }

        /* iOS Safari ä¼˜åŒ– */
        .code-editor:focus {
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .code-editor::placeholder {
            color: #666666;
        }

        .preview-frame {
            flex: 1;
            border: none;
            background: #ffffff;
            -webkit-overflow-scrolling: touch;
            /* iOS Safariæ»šåŠ¨ä¼˜åŒ– */
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
            /* ç¡®ä¿å†…å®¹å¯ä»¥æ»šåŠ¨ */
            overflow: auto;
            /* æ”¯æŒè§¦æ‘¸æ»šåŠ¨ */
            touch-action: pan-x pan-y;
        }

        /* æŒ‰é’®è§¦æ‘¸ä¼˜åŒ– - é’ˆå¯¹iOS Edge */
        .btn {
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid #3a3a3a;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }

        .btn:hover {
            background: #3a3a3a;
            border-color: #4a4a3a;
        }

        .btn:active {
            background: #1a1a1a;
            transform: translateY(0);
            opacity: 0.8;
        }
        
        /* iOS Safari/Edge ç‰¹æ®Šä¼˜åŒ– */
        @supports (-webkit-touch-callout: none) {
            .btn {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
                -webkit-appearance: none;
                appearance: none;
                -webkit-user-select: none;
                user-select: none;
            }
            
            .btn:active {
                opacity: 0.7;
                transform: scale(0.98);
            }
            
            /* iOSæŒ‰é’®ç‚¹å‡»å»¶è¿Ÿä¿®å¤ */
            .btn {
                cursor: pointer;
                -webkit-touch-callout: none;
            }
            
            /* é˜²æ­¢iOSåŒå‡»ç¼©æ”¾ */
            * {
                -webkit-touch-callout: none;
                -webkit-text-size-adjust: none;
            }
            
            /* iOSæ»šåŠ¨ä¼˜åŒ– */
            .code-editor {
                -webkit-overflow-scrolling: touch;

            }
        }
        
        /* iOS 13+ å¢å¼ºå…¼å®¹æ€§ */
        @media (pointer: coarse) {
            .btn {
                min-height: 44px; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸ç›®æ ‡ */
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .btn-group {
                gap: 8px;
            }
        }

        .btn-primary {
            background: #0066ff;
            border-color: #0066ff;
        }

        .btn-primary:hover {
            background: #0052cc;
            border-color: #0052cc;
        }

        .btn-secondary {
            background: #404040;
            border-color: #505050;
        }

        .btn-secondary:hover {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }

        .btn-success {
            background: #00a86b;
            border-color: #00a86b;
        }

        .btn-success:hover {
            background: #008c5a;
            border-color: #008c5a;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            min-height: auto;
        }

        .btn-info {
            background: #17a2b8;
            border-color: #17a2b8;
        }

        .btn-info:hover {
            background: #138496;
            border-color: #138496;
        }

        /* å…¨å±é¢„è§ˆæ ·å¼ */
        .fullscreen-preview {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            background: white !important;
            margin: 0 !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }

        .fullscreen-preview .panel-header {
            display: none !important;
        }

        .fullscreen-preview .panel-title,
        .fullscreen-preview .btn-group {
            display: none !important;
        }

        .fullscreen-preview .preview-frame {
            width: 100% !important;
            height: 100% !important;
            border: none !important;
        }

        /* è‡ªå®šä¹‰å…³é—­æŒ‰é’® */
        .fullscreen-close {
            position: fixed !important;
            top: 16px !important;
            right: 16px !important;
            width: 32px !important;
            height: 32px !important;
            z-index: 10000 !important;
            background: rgba(0, 0, 0, 0.2) !important;
            border: none !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            opacity: 0.3 !important;
            transition: all 0.2s ease !important;
            padding: 0 !important;
            outline: none !important;
        }

        .fullscreen-close:hover {
            opacity: 0.6 !important;
            background: rgba(0, 0, 0, 0.3) !important;
        }

        .fullscreen-close::before,
        .fullscreen-close::after {
            content: '' !important;
            position: absolute !important;
            width: 16px !important;
            height: 1.5px !important;
            background: white !important;
            transform-origin: center !important;
        }

        .fullscreen-close::before {
            transform: rotate(45deg) !important;
        }

        .fullscreen-close::after {
            transform: rotate(-45deg) !important;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-bar {
            background: #0d0d0d;
            color: #888888;
            padding: 8px 24px;
            font-size: 12px;
            border-top: 1px solid #2a2a2a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00a86b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .icon {
            width: 16px;
            height: 16px;
            display: inline-block;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .code-editor::-webkit-scrollbar {
            width: 8px;
        }

        .code-editor::-webkit-scrollbar-track {
            background: #0d0d0d;
        }

        .code-editor::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        .code-editor::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        /* ç§»åŠ¨è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .editor-panel {
                border-right: none;
                border-bottom: 1px solid #2a2a2a;
                flex: 0 0 50%;
                min-height: 200px;
            }
            
            .preview-panel {
                flex: 1;
                min-height: 200px;
            }

            .panel-header {
                padding: 10px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .panel-title {
                flex-shrink: 0;
            }

            .btn-group {
                gap: 6px;
                margin-left: auto;
                flex-shrink: 0;
                justify-content: flex-end;
            }

            .code-editor {
                padding: 12px;
                font-size: 13px;
                line-height: 1.5;
            }
            
            .button {
                padding: 6px 10px;
                font-size: 12px;
                min-height: 36px;
            }
            
            .status-bar {
                padding: 6px 12px;
                font-size: 11px;
            }
            
            .char-count {
                font-size: 11px;
            }
            
            /* ç§»åŠ¨è®¾å¤‡é€šçŸ¥ä½ç½®ï¼ˆä»£ç é¢æ¿å†…ï¼Œé å·¦ä¸Šï¼Œä¸‹æ»‘ï¼‰ */
            .editor-panel .toast {
                top: 56px;
                left: 50%; /* å¼ºåˆ¶å±…ä¸­ */
                transform: translate(-50%, -10px);
                max-width: calc(100% - 20px);
                font-size: 13px;
                padding: 10px 15px;
            }
        }

        /* å¹³æ¿è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 769px) and (max-width: 1024px) {
            .button {
                padding: 7px 12px;
                font-size: 12px;
            }
            
            .code-editor {
                font-size: 13px;
                padding: 15px;
            }
            
            .panel-header {
                padding: 14px 18px;
            }
            
            /* iPadç«–å±é€šçŸ¥ä¼˜åŒ–ï¼ˆä»£ç é¢æ¿å†…ï¼‰ */
            @media (orientation: portrait) {
                .editor-panel .toast {
                    top: 64px;
                    left: 50%; /* ç«–å±ä¹Ÿä¿æŒå±…ä¸­ */
                    transform: translate(-50%, -10px);
                    max-width: min(280px, calc(100% - 32px));
                    font-size: 13px;
                }
            }
        }

        /* æ¡Œé¢è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 1025px) {
            .container {
                max-width: 100vw;
                margin: 0 auto;
            }
        }

        /* iPadæ¨ªå±ç‰¹æ®Šä¼˜åŒ– */
        @media (min-width: 1024px) and (max-width: 1366px) and (orientation: landscape) {
            /* iPad Proæ¨ªå±é€šçŸ¥ï¼ˆä»£ç é¢æ¿å†…ï¼‰ */
            .editor-panel .toast {
                top: 64px;
                left: 50%; /* æ¨ªå±ä¿æŒå±…ä¸­ */
                transform: translate(-50%, -10px);
                max-width: min(350px, calc(100% - 48px));
                font-size: 14px;
            }
        }
        
        @media (min-width: 768px) and (max-width: 1023px) and (orientation: landscape) {
            /* iPadæ¨ªå±é€šçŸ¥ï¼ˆä»£ç é¢æ¿å†…ï¼‰ */
            .editor-panel .toast {
                top: 64px;
                left: 50%; /* æ¨ªå±ä¿æŒå±…ä¸­ */
                transform: translate(-50%, -10px);
                max-width: min(320px, calc(100% - 40px));
                font-size: 13px;
            }
        }

        /* å…¨å±é¢„è§ˆä¼˜åŒ– */
        .fullscreen-preview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: #1a1a1a;
            margin: 0;
            border: none;
            border-radius: 0;
        }

        .fullscreen-preview .panel-header {
            padding: 12px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fullscreen-preview .panel-title {
            font-size: 16px;
            font-weight: 500;
        }

        .fullscreen-preview .preview-frame {
            height: calc(100vh - 60px);
            width: 100%;
            border: none;
            background: white;
        }

        .fullscreen-preview .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #3a3a3a;
            background: #2a2a2a;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fullscreen-preview .btn:hover {
            background: #3a3a3a;
            border-color: #4a4a4a;
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .panel-header {
                padding: 8px 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: nowrap;
                gap: 8px;
            }

            .panel-title {
                font-size: 14px;
                flex-shrink: 0;
            }

            .btn-group {
                gap: 4px;
                margin-left: auto;
                flex-shrink: 0;
            }

            .button, .btn {
                padding: 5px 8px;
                font-size: 11px;
                min-height: 32px;
            }

            .code-editor {
                padding: 10px;
                font-size: 12px;
            }

            .status-bar {
                padding: 5px 10px;
                font-size: 10px;
            }

            .fullscreen-preview .panel-header {
                padding: 10px 15px;
            }

            .fullscreen-preview .btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            /* è¶…å°å±å¹•é€šçŸ¥ï¼ˆä»£ç é¢æ¿å†…ï¼‰ */
            .editor-panel .toast {
                top: 52px; /* æ›´è´´è¿‘é¡¶éƒ¨ */
                left: 50%; /* å±…ä¸­ */
                transform: translate(-50%, -10px);
                max-width: calc(100% - 16px);
                width: auto;
                font-size: 12px;
                padding: 8px 12px;
                border-radius: 6px;
            }
        }

        /* å¹³æ¿æ¨ªå±ä¼˜åŒ– */
        @media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
            .container {
                flex-direction: row;
            }
            
            .editor-panel {
                flex: 0 0 45%;
                border-right: 1px solid #2a2a2a;
                border-bottom: none;
            }
            
            .preview-panel {
                flex: 1;
            }
            
            /* iPadæ¨ªå±é€šçŸ¥ä¼˜åŒ– - é¿å…é®æŒ¡é¡¶éƒ¨æŒ‰é’®ï¼ˆä»£ç é¢æ¿å†…ï¼‰ */
            .editor-panel .toast {
                top: 70px; /* å¢åŠ é¡¶éƒ¨è·ç¦»ï¼Œé¿å…é®æŒ¡é¢æ¿æ ‡é¢˜ */
                left: 50%;
                transform: translate(-50%, -10px);
                max-width: 300px;
            }
        }

        /* å…¨å±é¢„è§ˆç§»åŠ¨è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 768px) and (orientation: portrait) {
            .fullscreen-preview .panel-header {
                padding: 10px 15px;
                display: flex;
                justify-content: flex-end;
                align-items: center;
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(0,0,0,0.8);
                border-radius: 8px;
                left: auto;
                width: auto;
            }
            
            .fullscreen-preview .preview-frame {
                height: calc(100vh - 50px);
            }
        }

        @media (max-width: 768px) and (orientation: landscape) {
            .fullscreen-preview .panel-header {
                padding: 8px 12px;
                display: flex;
                justify-content: flex-end;
                align-items: center;
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(0,0,0,0.8);
                border-radius: 8px;
                left: auto;
                width: auto;
            }
            
            .fullscreen-preview .preview-frame {
                height: calc(100vh - 45px);
            }
        }

        /* ç²˜è´´æŒ‰é’®åŠ¨ç”» */
        .paste-btn.pasting {
            animation: pastePulse 0.6s ease;
        }

        @keyframes pastePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background: #00a86b; }
            100% { transform: scale(1); }
        }

        /* æ¶ˆæ¯æç¤ºæ ·å¼ï¼šæ”¾åœ¨ä»£ç é¢æ¿å†…ï¼Œä»ä¸Šå‘ä¸‹æ»‘å…¥ */
        .editor-panel .toast {
            position: absolute;
            top: 64px; /* ä½äºç¼–è¾‘å™¨é¢æ¿æ ‡é¢˜ä¸‹æ–¹ï¼Œç´§è´´ä»£ç æ¡†é¡¶éƒ¨ */
            left: 50%; /* é¡¶éƒ¨å±…ä¸­ */
            transform: translate(-50%, -12px); /* åˆå§‹æ¯”ä»£ç æ¡†é¡¶éƒ¨ç•¥é«˜ä¸€äº› */
            background: rgba(30, 30, 30, 0.95);
            color: #ffffff;
            border: 1px solid #3a3a3a;
            border-radius: 10px;
            padding: 12px 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.03);
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transition: transform 0.25s ease, opacity 0.25s ease;
            max-width: min(360px, calc(100% - 32px));
            width: auto;
        }

        .editor-panel .toast.show {
            transform: translate(-50%, 20px); /* ä¸‹ç§»æ›´å¤šï¼Œå®Œå…¨è¿›å…¥ä»£ç æ¡†å†… */
            opacity: 1;
        }

        .toast.success {
            border-color: #00a86b;
            background: rgba(0, 168, 107, 0.1);
        }

        .toast.error {
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        /* å†å²è®°å½•é¢æ¿æ ·å¼ */
        .history-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 300px;
            background: #1a1a1a;
            border-top: 1px solid #2a2a2a;
            display: none;
            flex-direction: column;
            z-index: 100;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        }

        .history-panel.show {
            display: flex;
        }

        .history-header {
            padding: 12px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .history-item {
            padding: 12px 20px;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 13px;
        }

        .history-item:hover {
            background: #2a2a2a;
        }

        .history-item:active {
            background: #1a1a1a;
        }

        .history-item-content {
            color: #e6e6e6;
            margin-bottom: 8px;
            word-break: break-all;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item-info {
            color: #888888;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item-delete {
            background: none;
            border: none;
            color: #888888;
            cursor: pointer;
            font-size: 12px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .history-item-delete:hover {
            background: #3a3a3a;
            color: #ff4757;
        }

        /* å†å²è®°å½•é¢æ¿æ»šåŠ¨æ¡æ ·å¼ */
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        /* ç©ºå†å²è®°å½•æç¤º */
        .history-empty {
            padding: 40px 20px;
            text-align: center;
            color: #888888;
            font-size: 14px;
        }

        /* åˆ†äº«é¢æ¿æ ·å¼ */
        .share-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 400px;
            background: #1a1a1a;
            border-top: 1px solid #2a2a2a;
            display: none;
            flex-direction: column;
            z-index: 101;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        }

        .share-panel.show {
            display: flex;
        }

        .share-header {
            padding: 12px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
        }

        .share-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .share-description {
            color: #e6e6e6;
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.6;
        }

        .share-link-container {
            display: flex;
            margin-bottom: 20px;
            gap: 8px;
            align-items: center;
        }

        .share-link-input {
            flex: 1;
            padding: 10px 12px;
            background: #0d0d0d;
            border: 1px solid #2a2a2a;
            color: #e6e6e6;
            font-size: 13px;
            border-radius: 4px;
            outline: none;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .share-link-input:focus {
            border-color: #0066ff;
        }

        .share-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .share-tips {
            background: #2a2a2a;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #0066ff;
        }

        .share-tips h4 {
            color: #e6e6e6;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 500;
        }

        .share-tips ul {
            list-style-type: disc;
            list-style-position: inside;
            color: #888888;
            font-size: 13px;
        }

        .share-tips li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        /* åˆ†äº«é¢æ¿æ»šåŠ¨æ¡æ ·å¼ */
        .share-content::-webkit-scrollbar {
            width: 8px;
        }

        .share-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .share-content::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        .share-content::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        /* ç§»åŠ¨è®¾å¤‡é€‚é… */
        @media (max-width: 768px) {
            .share-content {
                padding: 12px;
            }
            
            .share-link-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .share-actions {
                flex-direction: column;
            }
            
            .share-tips {
                padding: 12px;
            }
        }

        /* è®¾ç½®é¢æ¿æ ·å¼ */
        .settings-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 450px;
            background: #1a1a1a;
            border-top: 1px solid #2a2a2a;
            display: none;
            flex-direction: column;
            z-index: 102;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        }

        .settings-panel.show {
            display: flex;
        }

        .settings-header {
            padding: 12px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
        }

        .settings-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #2a2a2a;
        }

        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 20px;
            padding-bottom: 0;
        }

        .settings-section h4 {
            color: #e6e6e6;
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .setting-item {
            margin-bottom: 16px;
        }

        .setting-label {
            display: block;
            color: #e6e6e6;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .setting-control {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .setting-input {
            padding: 8px 12px;
            background: #0d0d0d;
            border: 1px solid #2a2a2a;
            color: #e6e6e6;
            font-size: 13px;
            border-radius: 4px;
            outline: none;
            min-width: 200px;
        }

        .setting-input:focus {
            border-color: #0066ff;
        }

        .setting-input[type="number"] {
            min-width: 80px;
            width: 80px;
        }

        .setting-description {
            color: #888888;
            font-size: 11px;
            line-height: 1.5;
            margin: 0;
        }

        .settings-actions {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* è®¾ç½®é¢æ¿æ»šåŠ¨æ¡æ ·å¼ */
        .settings-content::-webkit-scrollbar {
            width: 8px;
        }

        .settings-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .settings-content::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        .settings-content::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        /* ç§»åŠ¨è®¾å¤‡é€‚é… */
        @media (max-width: 768px) {
            .settings-content {
                padding: 12px;
            }
            
            .settings-control {
                flex-direction: column;
                align-items: stretch;
            }
            
            .setting-input {
                min-width: auto;
            }
            
            .settings-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editor-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <button class="btn btn-link" onclick="showHelp()" style="background: none; border: none; color: inherit; font: inherit; cursor: pointer; padding: 0; display: flex; align-items: center;" type="button">
                        <span>âš¡</span>
                        <span style="margin-left: 8px;">HTML EDITOR</span>
                    </button>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="openLocalFile()" id="openBtn" type="button">
                        <span class="icon">ğŸ“</span>
                        æ‰“å¼€
                    </button>
                    <button class="btn btn-secondary" onclick="clearEditor()" id="clearBtn" type="button">
                        <span class="icon">ğŸ—‘ï¸</span>
                        æ¸…ç©º
                    </button>
                    <button class="btn btn-secondary" onclick="pasteFromClipboard()" id="pasteBtn" type="button">
                        <span class="icon">ğŸ“‹</span>
                        ç²˜è´´
                    </button>
                    <button class="btn btn-secondary" onclick="toggleHistoryPanel()" id="historyBtn" type="button">
                        <span class="icon">ğŸ•’</span>
                        å†å²
                    </button>
                    <button class="btn btn-primary" onclick="toggleSharePanel()" id="shareBtn" type="button">
                        <span class="icon">ğŸ”—</span>
                        åˆ†äº«
                    </button>
                    <button class="btn btn-info" onclick="toggleSettingsPanel()" id="settingsBtn" type="button">
                        <span class="icon">âš™ï¸</span>
                        è®¾ç½®
                    </button>
                </div>
            </div>
            <textarea id="htmlEditor" class="code-editor" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„HTMLä»£ç ï¼Œæˆ–è€…ç‚¹å‡»ç²˜è´´æŒ‰é’®ä»å‰ªè´´æ¿å¯¼å…¥..."></textarea>
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>å®æ—¶é¢„è§ˆ</span>
                </div>
                <div>
                    <span id="charCount">0</span> å­—ç¬¦
                </div>
            </div>
            
            <!-- å†å²è®°å½•é¢æ¿ -->
            <div id="historyPanel" class="history-panel">
                <div class="history-header">
                    <span>ğŸ“‹ å†å²è®°å½•</span>
                    <button class="btn btn-sm btn-secondary" onclick="clearHistory()">æ¸…ç©ºå†å²</button>
                </div>
                <div id="historyList" class="history-list"></div>
            </div>
            
            <!-- åˆ†äº«é¢æ¿ -->
            <div id="sharePanel" class="share-panel">
                <div class="share-header">
                    <span>ğŸ”— åˆ†äº«é“¾æ¥</span>
                    <button class="btn btn-sm btn-secondary" onclick="toggleSharePanel()">å…³é—­</button>
                </div>
                <div class="share-content">
                    <p class="share-description">ç”Ÿæˆä¸€ä¸ªå¯åˆ†äº«çš„é“¾æ¥ï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡è¯¥é“¾æ¥æŸ¥çœ‹å’Œç¼–è¾‘å½“å‰å†…å®¹ï¼š</p>
                    <div class="share-link-container">
                        <input type="text" id="shareLink" class="share-link-input" readonly>
                        <button class="btn btn-sm btn-primary" onclick="copyShareLink()">å¤åˆ¶é“¾æ¥</button>
                    </div>
                    <div class="share-actions">
                        <button class="btn btn-secondary" onclick="generateShareLink()">é‡æ–°ç”Ÿæˆ</button>
                        <button class="btn btn-success" onclick="openShareLink()">åœ¨æ–°çª—å£æ‰“å¼€</button>
                        <button class="btn btn-primary" onclick="generateOnlineLink()">è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿é“¾æ¥</button>
                    </div>
                    <div class="share-tips">
                        <h4>ğŸ’¡ åˆ†äº«æç¤ºï¼š</h4>
                        <ul>
                            <li>é“¾æ¥åŒ…å«äº†å½“å‰ç¼–è¾‘å™¨çš„æ‰€æœ‰å†…å®¹</li>
                            <li>é“¾æ¥å¯ä»¥è¢«ä»»ä½•äººè®¿é—®å’Œä¿®æ”¹</li>
                            <li>é“¾æ¥è¾ƒé•¿ï¼Œå»ºè®®ä½¿ç”¨é“¾æ¥ç¼©çŸ­å·¥å…·</li>
                            <li>åˆ·æ–°é¡µé¢åé“¾æ¥ä»ç„¶æœ‰æ•ˆ</li>
                            <li>å¯åœ¨è®¾ç½®ä¸­è‡ªå®šä¹‰åˆ†äº«é“¾æ¥çš„åŸºç¡€URL</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- è®¾ç½®é¢æ¿ -->
            <div id="settingsPanel" class="settings-panel">
                <div class="settings-header">
                    <span>âš™ï¸ ç¼–è¾‘å™¨è®¾ç½®</span>
                    <button class="btn btn-sm btn-secondary" onclick="toggleSettingsPanel()">å…³é—­</button>
                </div>
                <div class="settings-content">
                    <div class="settings-section">
                        <h4>ğŸ”— åˆ†äº«è®¾ç½®</h4>
                        <div class="setting-item">
                            <label for="shareBaseUrl" class="setting-label">åˆ†äº«é“¾æ¥åŸºç¡€URLï¼š</label>
                            <div class="setting-control">
                                <input type="text" id="shareBaseUrl" class="setting-input" placeholder="ä¾‹å¦‚ï¼šhttps://example.com/editor.html">
                                <button class="btn btn-sm btn-primary" onclick="saveShareBaseUrl()">ä¿å­˜</button>
                                <button class="btn btn-sm btn-secondary" onclick="resetShareBaseUrl()">é‡ç½®</button>
                            </div>
                            <p class="setting-description">è®¾ç½®ç”¨äºç”Ÿæˆåˆ†äº«é“¾æ¥çš„åŸºç¡€URLï¼Œé»˜è®¤ä½¿ç”¨å½“å‰é¡µé¢URLã€‚</p>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>ğŸ’¾ è‡ªåŠ¨ä¿å­˜</h4>
                        <div class="setting-item">
                            <label for="autoSaveInterval" class="setting-label">è‡ªåŠ¨ä¿å­˜é—´éš”ï¼ˆç§’ï¼‰ï¼š</label>
                            <div class="setting-control">
                                <input type="number" id="autoSaveInterval" class="setting-input" min="1" max="600" value="10">
                                <button class="btn btn-sm btn-primary" onclick="saveAutoSaveInterval()">ä¿å­˜</button>
                            </div>
                            <p class="setting-description">è®¾ç½®ç¼–è¾‘å™¨è‡ªåŠ¨ä¿å­˜å†…å®¹çš„æ—¶é—´é—´éš”ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>ğŸ“ å†å²è®°å½•</h4>
                        <div class="setting-item">
                            <label for="maxHistoryRecords" class="setting-label">æœ€å¤§å†å²è®°å½•æ•°ï¼š</label>
                            <div class="setting-control">
                                <input type="number" id="maxHistoryRecords" class="setting-input" min="1" max="50" value="10">
                                <button class="btn btn-sm btn-primary" onclick="saveMaxHistoryRecords()">ä¿å­˜</button>
                            </div>
                            <p class="setting-description">è®¾ç½®ç¼–è¾‘å™¨ä¿å­˜çš„æœ€å¤§å†å²è®°å½•æ•°é‡ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="applyAllSettings()">åº”ç”¨æ‰€æœ‰è®¾ç½®</button>
                        <button class="btn btn-secondary" onclick="loadSettings()">é‡æ–°åŠ è½½è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="preview-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>ğŸ‘ï¸</span>
                    <span>é¢„è§ˆ</span>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="toggleFullscreenPreview()" id="fullscreenBtn">
                        <span class="icon">â›¶</span>
                        å…¨å±
                    </button>
                    <button class="btn btn-secondary" onclick="printPreview()" id="printBtn">
                        <span class="icon">ğŸ–¨ï¸</span>
                        æ‰“å°
                    </button>
                    <button class="btn btn-primary" onclick="downloadHTML()" id="downloadBtn">
                        <span class="icon">ğŸ’¾</span>
                        ä¸‹è½½
                    </button>
                </div>
            </div>
            <iframe id="previewFrame" class="preview-frame"></iframe>
        </div>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´  -->
    <input type="file" id="fileInput" accept=".html,.htm" style="display: none;">

    <script>
        const htmlEditor = document.getElementById('htmlEditor');
        const previewFrame = document.getElementById('previewFrame');
        const charCount = document.getElementById('charCount');
        const pasteBtn = document.getElementById('pasteBtn');
        const clearBtn = document.getElementById('clearBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const openBtn = document.getElementById('openBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const printBtn = document.getElementById('printBtn');
        const historyBtn = document.getElementById('historyBtn');
        const shareBtn = document.getElementById('shareBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const fileInput = document.getElementById('fileInput');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');
        const sharePanel = document.getElementById('sharePanel');
        const shareLink = document.getElementById('shareLink');
        const settingsPanel = document.getElementById('settingsPanel');
        const shareBaseUrlInput = document.getElementById('shareBaseUrl');
        const autoSaveIntervalInput = document.getElementById('autoSaveInterval');
        const maxHistoryRecordsInput = document.getElementById('maxHistoryRecords');
        
        // å†å²è®°å½•ç›¸å…³å˜é‡
        let historyRecords = [];
        let MAX_HISTORY_RECORDS = 10;
        const HISTORY_STORAGE_KEY = 'htmlEditorHistory';
        
        // åˆ†äº«ç›¸å…³å˜é‡
        const SHARE_PARAM_NAME = 'content';
        let shareBaseUrl = '';
        
        // è‡ªåŠ¨ä¿å­˜ç›¸å…³å˜é‡
        let autoSaveInterval = 10;
        const SETTINGS_STORAGE_KEY = 'htmlEditorSettings';

        // é»˜è®¤HTMLæ¨¡æ¿ - é’ˆå¯¹ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–
        const defaultHTML = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„HTML5é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 30px 20px;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        h1 {
            color: #1d1d1f;
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 600;
            text-align: center;
        }
        
        p {
            color: #86868b;
            font-size: 16px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .feature {
            background: #f5f5f7;
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
        }
        
        .feature h3 {
            color: #1d1d1f;
            margin-bottom: 8px;
            font-size: 18px;
        }
        
        .feature p {
            color: #86868b;
            font-size: 14px;
            margin: 0;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            p {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ æ¬¢è¿ä½¿ç”¨HTML5ç¼–è¾‘å™¨</h1>
        <p>è¿™æ˜¯ä¸€ä¸ªå“åº”å¼çš„HTML5é¡µé¢æ¨¡æ¿ï¼Œå®Œç¾é€‚é…iOSã€Androidã€macOSå’ŒWindowsè®¾å¤‡ã€‚</p>
        
        <div class="feature">
            <h3>ğŸ“± ç§»åŠ¨ä¼˜å…ˆ</h3>
            <p>åœ¨å„ç§ç§»åŠ¨è®¾å¤‡ä¸Šéƒ½æœ‰å‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœ</p>
        </div>
        
        <div class="feature">
            <h3>ğŸ’» è·¨å¹³å°å…¼å®¹</h3>
            <p>æ”¯æŒiOSã€Androidã€macOSã€Windowsç­‰ä¸»æµå¹³å°</p>
        </div>
        
        <div class="feature">
            <h3>ğŸš€ æ€§èƒ½ä¼˜åŒ–</h3>
            <p>å¿«é€ŸåŠ è½½ï¼Œæµç•…çš„ç”¨æˆ·ä½“éªŒ</p>
        </div>
    </div>
</body>
</html>`;

        // åˆå§‹åŒ–ç¼–è¾‘å™¨ - ä¿®æ”¹ä¸ºæ¸…ç©ºçŠ¶æ€
        htmlEditor.value = '';
        updateCharCount();
        
        // IEæµè§ˆå™¨å…¼å®¹æ€§ï¼šç¡®ä¿iframeæ­£ç¡®åˆå§‹åŒ–
        if (document.documentMode || /Edge/.test(navigator.userAgent)) {
            previewFrame.style.display = 'block';
            previewFrame.style.width = '100%';
            previewFrame.style.height = 'calc(100% - 60px)';
        }
        
        // å»¶è¿Ÿåˆå§‹åŒ–é¢„è§ˆï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
        setTimeout(function() {
            updatePreview();
        }, 100);

        // å®æ—¶é¢„è§ˆåŠŸèƒ½ - ä¼˜åŒ–è§¦æ‘¸è®¾å¤‡ä½“éªŒ
        let updateTimeout;
        htmlEditor.addEventListener('input', function() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(updatePreview, 100);
            updateCharCount();
        });
        
        // iOS Edgeæµè§ˆå™¨å…¼å®¹æ€§ï¼šç›‘å¬changeäº‹ä»¶
        htmlEditor.addEventListener('change', function() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(updatePreview, 100);
            updateCharCount();
        });
        
        // IEæµè§ˆå™¨å…¼å®¹æ€§ï¼šç›‘å¬propertychangeäº‹ä»¶
        if (document.documentMode || /Edge/.test(navigator.userAgent)) {
            htmlEditor.addEventListener('propertychange', function(e) {
                if (e.propertyName === 'value') {
                    clearTimeout(updateTimeout);
                    updateTimeout = setTimeout(updatePreview, 100);
                    updateCharCount();
                }
            });
        }
        
        // ç›‘å¬keyupäº‹ä»¶ä»¥ç¡®ä¿IEå…¼å®¹æ€§
        htmlEditor.addEventListener('keyup', function() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(updatePreview, 100);
            updateCharCount();
        });
        
        // è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– - é˜²æ­¢é”®ç›˜é®æŒ¡
        let initialLoad = true;
        htmlEditor.addEventListener('focus', function() {
            // é¦–æ¬¡åŠ è½½æ—¶ä¸æ‰§è¡Œæ»šåŠ¨
            if (initialLoad) {
                initialLoad = false;
                return;
            }
            // å»¶è¿Ÿæ»šåŠ¨ç¡®ä¿ç¼–è¾‘å™¨å¯è§ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰§è¡Œ
            if (document.activeElement === htmlEditor) {
                setTimeout(() => {
                    const rect = htmlEditor.getBoundingClientRect();
                    const isVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;
                    if (!isVisible) {
                        htmlEditor.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            }
        });

        function updatePreview() {
            const code = htmlEditor.value;
            const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            try {
                // ä½¿ç”¨srcdocå±æ€§é¿å…é‡å¤å£°æ˜é—®é¢˜ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
                if ('srcdoc' in previewFrame) {
                    previewFrame.srcdoc = code;
                } else {
                    // IEæµè§ˆå™¨å…¼å®¹æ€§å¤„ç†
                    if (previewDoc.open && previewDoc.write && previewDoc.close) {
                        previewDoc.open();
                        previewDoc.write(code);
                        previewDoc.close();
                    } else {
                        // å¯¹äºIEçš„å¤‡ç”¨æ–¹æ¡ˆ
                        previewFrame.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(code);
                    }
                }
                
                // å»¶è¿Ÿåº”ç”¨æ»šåŠ¨ä¼˜åŒ–ï¼Œç¡®ä¿å†…å®¹å®Œå…¨åŠ è½½
                setTimeout(() => {
                    enhancePreviewScrolling();
                }, 50);
            } catch (error) {
                console.log('Preview update error:', error);
                // IEæµè§ˆå™¨å¤‡ç”¨æ–¹æ¡ˆ
                try {
                    previewFrame.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(code);
                } catch (ieError) {
                    console.log('IE preview fallback error:', ieError);
                }
            }
        }

        function refreshPreview() {
            updatePreview();
        }

        // æ‰“å¼€æœ¬åœ°HTMLæ–‡ä»¶
        function openLocalFile() {
            // è§¦å‘æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
            fileInput.click();
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.name.toLowerCase().endsWith('.html') && !file.name.toLowerCase().endsWith('.htm')) {
                showToast('è¯·é€‰æ‹©HTMLæ–‡ä»¶', 'error');
                return;
            }

            // è¯»å–æ–‡ä»¶å†…å®¹
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    // å°†æ–‡ä»¶å†…å®¹æ˜¾ç¤ºåœ¨é¢„è§ˆçª—å£ä¸­
                    displayFileInPreview(content);
                    
                    // å¯é€‰ï¼šå°†å†…å®¹ä¹ŸåŠ è½½åˆ°ç¼–è¾‘å™¨ä¸­
                    if (confirm('æ˜¯å¦å°†æ–‡ä»¶å†…å®¹åŠ è½½åˆ°ç¼–è¾‘å™¨ä¸­ï¼Ÿ')) {
                        htmlEditor.value = content;
                        updateCharCount();
                    }
                    
                    showToast(`å·²æ‰“å¼€æ–‡ä»¶: ${file.name}`, 'success');
                } catch (error) {
                    console.error('æ–‡ä»¶è¯»å–é”™è¯¯:', error);
                    showToast('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            };
            
            reader.onerror = function() {
                showToast('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            };
            
            // ä»¥æ–‡æœ¬å½¢å¼è¯»å–æ–‡ä»¶
            reader.readAsText(file, 'UTF-8');
        });

        // åœ¨é¢„è§ˆçª—å£ä¸­æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
        function displayFileInPreview(content) {
            try {
                const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                
                // ä½¿ç”¨srcdocå±æ€§é¿å…é‡å¤å£°æ˜é—®é¢˜ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
                if ('srcdoc' in previewFrame) {
                    previewFrame.srcdoc = content;
                } else {
                    // IEæµè§ˆå™¨å…¼å®¹æ€§å¤„ç†
                    if (previewDoc.open && previewDoc.write && previewDoc.close) {
                        previewDoc.open();
                        previewDoc.write(content);
                        previewDoc.close();
                    } else {
                        // å¯¹äºIEçš„å¤‡ç”¨æ–¹æ¡ˆ
                        previewFrame.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(content);
                    }
                }
                
                // iOS Safariæ»šåŠ¨ä¼˜åŒ–
                enhancePreviewScrolling();
            } catch (error) {
                console.error('é¢„è§ˆæ›´æ–°é”™è¯¯:', error);
                // IEæµè§ˆå™¨å¤‡ç”¨æ–¹æ¡ˆ
                try {
                    previewFrame.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(content);
                } catch (ieError) {
                    console.error('IEé¢„è§ˆå¤‡ç”¨æ–¹æ¡ˆé”™è¯¯:', ieError);
                    showToast('é¢„è§ˆæ˜¾ç¤ºå¤±è´¥', 'error');
                }
            }
        }

        // å¢å¼ºé¢„è§ˆçª—å£çš„æ»šåŠ¨ä½“éªŒ
        function enhancePreviewScrolling() {
            try {
                const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                
                if (!previewDoc || !previewDoc.body) {
                    return;
                }

                // ä¸ºé¢„è§ˆæ–‡æ¡£æ·»åŠ iOS Safariæ»šåŠ¨ä¼˜åŒ–æ ·å¼
                const style = previewDoc.createElement('style');
                style.textContent = `
                    /* iOS Safariæ»šåŠ¨ä¼˜åŒ– */
                    html, body {
                        -webkit-overflow-scrolling: touch !important;
                        overscroll-behavior: contain !important;
                        touch-action: pan-x pan-y !important;
                        /* ç¡®ä¿å†…å®¹å¯ä»¥æ»šåŠ¨ */
                        overflow: auto !important;
                        /* é˜²æ­¢iOS Safariçš„æ©¡çš®ç­‹æ•ˆæœå½±å“æ»šåŠ¨ */
                        position: relative !important;
                    }
                    
                    /* é’ˆå¯¹A4ç‰ˆé¢å†…å®¹çš„æ»šåŠ¨ä¼˜åŒ– */
                    body {
                        min-height: 100vh !important;
                        /* å…è®¸å†…å®¹è¶…å‡ºè§†å£ */
                        overflow-x: auto !important;
                        overflow-y: auto !important;
                    }
                    
                    /* ç¡®ä¿æ‰€æœ‰å®¹å™¨éƒ½æ”¯æŒæ»šåŠ¨ */
                    * {
                        -webkit-overflow-scrolling: touch !important;
                    }
                `;
                
                // å°†æ ·å¼æ·»åŠ åˆ°é¢„è§ˆæ–‡æ¡£çš„å¤´éƒ¨
                if (previewDoc.head) {
                    previewDoc.head.appendChild(style);
                } else {
                    // å¦‚æœæ²¡æœ‰headæ ‡ç­¾ï¼Œåˆ›å»ºä¸€ä¸ª
                    const head = previewDoc.createElement('head');
                    head.appendChild(style);
                    previewDoc.documentElement.insertBefore(head, previewDoc.body);
                }
                
                // iOS Safariç‰¹æ®Šå¤„ç†ï¼šç¡®ä¿iframeå†…å®¹å¯ä»¥æ»šåŠ¨
                if (isIOS()) {
                    // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿å†…å®¹å®Œå…¨åŠ è½½
                    setTimeout(() => {
                        try {
                            const previewBody = previewDoc.body;
                            if (previewBody) {
                                // æ·»åŠ è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨
                                previewBody.addEventListener('touchstart', function(e) {
                                    // å…è®¸è§¦æ‘¸æ»šåŠ¨
                                    e.stopPropagation();
                                }, { passive: true });
                                
                                previewBody.addEventListener('touchmove', function(e) {
                                    // å…è®¸è§¦æ‘¸æ»šåŠ¨
                                    e.stopPropagation();
                                }, { passive: true });
                                
                                // ç¡®ä¿å†…å®¹å¯ä»¥æ»šåŠ¨
                                previewBody.style.overflow = 'auto';
                                previewBody.style.webkitOverflowScrolling = 'touch';
                            }
                        } catch (error) {
                            console.log('iOSæ»šåŠ¨ä¼˜åŒ–é”™è¯¯:', error);
                        }
                    }, 100);
                }
                
                // Android è®¾å¤‡ï¼šå•æŒ‡æ‹–åŠ¨æ»šåŠ¨å›é€€æ–¹æ¡ˆï¼ˆé€‚é…å›ºå®šç‰ˆé¢/A4å†…å®¹ï¼‰
                try {
                    const isAndroid = /Android/i.test(navigator.userAgent);
                    if (isAndroid) {
                        const scrollEl = previewDoc.scrollingElement || previewDoc.documentElement || previewDoc.body;
                        if (!scrollEl) return;

                        // ç¡®ä¿æ»šåŠ¨å¼€å¯ï¼Œå¹¶å‡å°‘æµè§ˆå™¨æ‰‹åŠ¿å¹²æ‰°
                        const targets = [previewDoc.documentElement, previewDoc.body];
                        targets.forEach(el => {
                            if (!el) return;
                            el.style.overflowX = 'auto';
                            el.style.overflowY = 'auto';
                            el.style.overscrollBehavior = 'contain';
                            // ä¸ºç¡®ä¿æ‰‹åŠ¿ç”±æˆ‘ä»¬æ¥ç®¡ï¼Œç¦ç”¨æµè§ˆå™¨é»˜è®¤æ‰‹åŠ¿è§£æ
                            el.style.touchAction = 'none';
                        });

                        let isTouching = false;
                        let startX = 0;
                        let startY = 0;
                        let startScrollLeft = 0;
                        let startScrollTop = 0;

                        previewDoc.addEventListener('touchstart', function(e) {
                            if (e.touches.length !== 1) return;
                            isTouching = true;
                            const t = e.touches[0];
                            startX = t.clientX;
                            startY = t.clientY;
                            startScrollLeft = scrollEl.scrollLeft;
                            startScrollTop = scrollEl.scrollTop;
                        }, { passive: true });

                        previewDoc.addEventListener('touchmove', function(e) {
                            if (!isTouching || e.touches.length !== 1) return;
                            const t = e.touches[0];
                            const dx = t.clientX - startX;
                            const dy = t.clientY - startY;
                            // åå‘è®¾ç½®ä»¥ç¬¦åˆæ‹–åŠ¨ç›´è§‰
                            scrollEl.scrollLeft = startScrollLeft - dx;
                            scrollEl.scrollTop = startScrollTop - dy;
                            // é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼Œé¿å…é¡µé¢å±‚é¢çš„æ‰‹åŠ¿æ‹¦æˆª
                            e.preventDefault();
                        }, { passive: false });

                        previewDoc.addEventListener('touchend', function() {
                            isTouching = false;
                        }, { passive: true });
                    }
                } catch (androidEnhanceError) {
                    console.log('Androidæ»šåŠ¨å¢å¼ºé”™è¯¯:', androidEnhanceError);
                }
                
            } catch (error) {
                console.log('é¢„è§ˆæ»šåŠ¨ä¼˜åŒ–é”™è¯¯:', error);
            }
        }

        function clearEditor() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç¼–è¾‘å™¨å—ï¼Ÿ')) {
                // iOS Safari/Edgeæµè§ˆå™¨å…¼å®¹æ€§å¤„ç†
                // åˆå§‹åŒ–ç¼–è¾‘å™¨ - ä¿®æ”¹ä¸ºæ¸…ç©ºçŠ¶æ€
                htmlEditor.value = '';
                updateCharCount();
                
                // ç¡®ä¿é¢„è§ˆåŒºåŸŸä¹Ÿæ˜¯ç©ºçš„
                updatePreview();
                
                // å»¶è¿Ÿå†æ¬¡æ¸…ç©ºç¡®ä¿å®Œå…¨åˆå§‹åŒ–
                setTimeout(function() {
                    updatePreview();
                    updateCharCount();
                }, 100);
                
                setTimeout(function() {
                    updatePreview();
                    updateCharCount();
                }, 200);
                
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                localStorage.removeItem('htmlEditorContent');
                
                showToast('ç¼–è¾‘å™¨å·²æ¸…ç©º', 'success');
            }
        }

        function updateCharCount() {
            charCount.textContent = htmlEditor.value.length;
        }

        // ä»å‰ªè´´æ¿ç²˜è´´
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                htmlEditor.value = text;
                htmlEditor.focus();
                updatePreview();
                showToast('å·²ä»å‰ªè´´æ¿ç²˜è´´', 'success');
                
                // æ·»åŠ æŒ‰é’®åŠ¨ç”»æ•ˆæœ
                pasteBtn.classList.add('pasting');
                setTimeout(() => pasteBtn.classList.remove('pasting'), 600);
            } catch (err) {
                showToast('æ— æ³•è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´', 'error');
            }
        }

        // Toast æ¶ˆæ¯æç¤º
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            const editorPanel = document.querySelector('.editor-panel');
            (editorPanel || document.body).appendChild(toast);
            
            // iPadè®¾å¤‡è°ƒæ•´é€šçŸ¥ä½ç½®ï¼ˆé’ˆå¯¹ä»£ç é¢æ¿å†…çš„toastï¼‰
            adjustToastPositionForiPad();
            
            // è§¦å‘æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // 1ç§’åç§»é™¤ï¼ˆåŸä¸º3ç§’ï¼‰
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 1000);
        }

        function downloadHTML() {
            const code = htmlEditor.value;
            if (!code.trim()) {
                showToast('è¯·å…ˆè¾“å…¥HTMLä»£ç ', 'error');
                return;
            }

            const blob = new Blob([code], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('HTMLæ–‡ä»¶ä¸‹è½½æˆåŠŸ', 'success');
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // å¿«æ·é”®æ”¯æŒ
        htmlEditor.addEventListener('keydown', function(e) {
            // Ctrl+S ä¿å­˜
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                downloadHTML();
            }
            // Ctrl+R åˆ·æ–°é¢„è§ˆ
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshPreview();
            }
            // Ctrl+V ç²˜è´´ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰ - å…¼å®¹å„ç§è®¾å¤‡
            if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                // è®©æµè§ˆå™¨é»˜è®¤ç²˜è´´è¡Œä¸ºå‘ç”Ÿï¼Œç„¶åæ›´æ–°é¢„è§ˆ
                setTimeout(() => {
                    updatePreview();
                    updateCharCount();
                }, 100);
            }
        });

        // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ - ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡ä½“éªŒ
        let autoSaveTimeout;
        htmlEditor.addEventListener('input', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(function() {
                localStorage.setItem('htmlEditorContent', htmlEditor.value);
                // æ¯10ç§’è‡ªåŠ¨æ·»åŠ åˆ°å†å²è®°å½•
                if (Date.now() - lastHistoryAddTime > 10000) {
                    addToHistory();
                    lastHistoryAddTime = Date.now();
                }
            }, 1000);
        });
        
        // iOS Edgeæµè§ˆå™¨ï¼šç›‘å¬changeäº‹ä»¶ç”¨äºè‡ªåŠ¨ä¿å­˜
        htmlEditor.addEventListener('change', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(function() {
                localStorage.setItem('htmlEditorContent', htmlEditor.value);
                addToHistory();
            }, 1000);
        });
        
        // å†å²è®°å½•æ·»åŠ æ—¶é—´æˆ³
        let lastHistoryAddTime = Date.now();
        
        // é¡µé¢å¸è½½æ—¶æ·»åŠ åˆ°å†å²è®°å½•
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('htmlEditorContent', htmlEditor.value);
            addToHistory();
        });
        
        // åˆ‡æ¢å†å²è®°å½•é¢æ¿æ˜¾ç¤º/éšè—
        function toggleHistoryPanel() {
            historyPanel.classList.toggle('show');
            if (historyPanel.classList.contains('show')) {
                displayHistory();
            }
        }
        
        // æ˜¾ç¤ºå†å²è®°å½•åˆ—è¡¨
        function displayHistory() {
            if (historyRecords.length === 0) {
                historyList.innerHTML = '<div class="history-empty">æš‚æ— å†å²è®°å½•</div>';
                return;
            }
            
            historyList.innerHTML = historyRecords.map(record => {
                const date = new Date(record.timestamp).toLocaleString('zh-CN');
                return `
                    <div class="history-item" onclick="restoreFromHistory(${record.id})">
                        <div class="history-item-content">${escapeHtml(record.preview)}</div>
                        <div class="history-item-info">
                            <span>${date}</span>
                            <button class="history-item-delete" onclick="event.stopPropagation(); deleteHistoryItem(${record.id})">Ã—</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ä»å†å²è®°å½•æ¢å¤ä»£ç 
        function restoreFromHistory(id) {
            const record = historyRecords.find(r => r.id === id);
            if (record) {
                htmlEditor.value = record.content;
                updatePreview();
                updateCharCount();
                historyPanel.classList.remove('show');
                showToast('å·²ä»å†å²è®°å½•æ¢å¤', 'success');
            }
        }
        
        // åˆ é™¤å•æ¡å†å²è®°å½•
        function deleteHistoryItem(id) {
            historyRecords = historyRecords.filter(r => r.id !== id);
            saveHistory();
            displayHistory();
            showToast('å†å²è®°å½•å·²åˆ é™¤', 'success');
        }
        
        // æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                historyRecords = [];
                localStorage.removeItem(HISTORY_STORAGE_KEY);
                displayHistory();
                showToast('å†å²è®°å½•å·²æ¸…ç©º', 'success');
            }
        }
        
        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶ä¿å­˜ - ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                localStorage.setItem('htmlEditorContent', htmlEditor.value);
            }
        });
        
        // é¡µé¢å¸è½½å‰ä¿å­˜
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('htmlEditorContent', htmlEditor.value);
        });
        
        // ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–ï¼šå¤„ç†é¡µé¢åˆ‡æ¢å’Œåå°è¿è¡Œ
        window.addEventListener('blur', function() {
            localStorage.setItem('htmlEditorContent', htmlEditor.value);
        });
        
        // å¤„ç†è®¾å¤‡æ—‹è½¬
        // å¤„ç†è§†å£é«˜åº¦å˜åŒ–å’Œè®¾å¤‡æ–¹å‘å˜åŒ–
        function updateViewportHeight() {
            // è·å–çœŸå®çš„è§†å£é«˜åº¦
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            
            // æ›´æ–°ç¼–è¾‘å™¨é«˜åº¦
            htmlEditor.style.height = 'auto';
            htmlEditor.style.height = htmlEditor.scrollHeight + 'px';
            
            // å¤„ç†é€šçŸ¥ä½ç½®
            const toast = document.querySelector('.editor-panel .toast');
            if (toast) {
                const isLandscape = window.innerWidth > window.innerHeight;
                toast.style.top = isLandscape ? '85px' : '80px';
            }
        }

        // ç›‘å¬æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', function() {
            // ç­‰å¾…æ–¹å‘å˜åŒ–å®Œæˆ
            setTimeout(updateViewportHeight, 300);
        });

        // ç›‘å¬è§†å£å¤§å°å˜åŒ–ï¼ˆåŒ…æ‹¬åœ°å€æ æ”¶èµ·/å±•å¼€ï¼‰
        window.addEventListener('resize', function() {
            updateViewportHeight();
        });

        // åˆå§‹åŒ–è§†å£é«˜åº¦
        updateViewportHeight();
        
        // iPadæ£€æµ‹å‡½æ•°
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }
        
        // åŠ¨æ€è°ƒæ•´iPadé€šçŸ¥ä½ç½®
        function adjustToastPositionForiPad() {
            if (isIOS()) {
                const toast = document.querySelector('.editor-panel .toast');
                if (toast) {
                    // æ£€æµ‹æ˜¯å¦ä¸ºæ¨ªå±
                    const isLandscape = window.innerWidth > window.innerHeight;
                    if (isLandscape) {
                        // æ¨ªå±æ¨¡å¼å¢åŠ é¡¶éƒ¨è·ç¦»
                        const screenWidth = window.innerWidth;
                        if (screenWidth >= 1366) {
                            // iPad Pro
                            toast.style.top = '90px';
                        } else if (screenWidth >= 1024) {
                            // æ ‡å‡†iPad
                            toast.style.top = '80px';
                        } else {
                            // è¾ƒå°iPad
                            toast.style.top = '75px';
                        }
                    } else {
                        // ç«–å±æ¨¡å¼ä½¿ç”¨CSSä¸­å®šä¹‰çš„ä½ç½®
                        toast.style.top = '';
                    }
                }
            }
        }
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', adjustToastPositionForiPad);

        function loadFromLocalStorage() {
            // ä¿®æ”¹ä¸ºä¸è‡ªåŠ¨åŠ è½½ä¹‹å‰çš„å†…å®¹ï¼Œä¿æŒæ¸…ç©ºçŠ¶æ€
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ¬¢è¿ä¿¡æ¯æˆ–å…¶ä»–åˆå§‹åŒ–é€»è¾‘
            showToast('HTMLç¼–è¾‘å™¨å·²å‡†å¤‡å°±ç»ª', 'success');
        }
        
        // åŠŸèƒ½ç®€ä»‹æ˜¾ç¤ºå‡½æ•°
        function showHelp() {
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 16px;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                margin: 20px;
            `;
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="color: #1d1d1f; margin: 0 0 10px 0; font-size: 24px; font-weight: 600;">ğŸ‰ æ¬¢è¿ä½¿ç”¨HTML5ç¼–è¾‘å™¨</h2>
                    <p style="color: #86868b; margin: 0; font-size: 16px;">è¿™æ˜¯ä¸€ä¸ªå“åº”å¼çš„HTML5é¡µé¢æ¨¡æ¿ï¼Œå®Œç¾é€‚é…iOSã€Androidã€macOSå’ŒWindowsè®¾å¤‡ã€‚</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 18px;">ğŸ“± ç§»åŠ¨ä¼˜å…ˆ</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">åœ¨å„ç§ç§»åŠ¨è®¾å¤‡ä¸Šéƒ½æœ‰å‡ºè‰²çš„æ˜¾ç¤ºæ•ˆæœ</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 18px;">ğŸ’» è·¨å¹³å°å…¼å®¹</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">æ”¯æŒiOSã€Androidã€macOSã€Windowsç­‰ä¸»æµå¹³å°</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 18px;">ğŸš€ æ€§èƒ½ä¼˜åŒ–</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">å¿«é€ŸåŠ è½½ï¼Œæµç•…çš„ç”¨æˆ·ä½“éªŒ</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 18px;">ğŸ“ å®æ—¶ç¼–è¾‘</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">æ‰€è§å³æ‰€å¾—çš„HTMLç¼–è¾‘ä½“éªŒ</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 18px;">ğŸ’¾ æ™ºèƒ½ä¿å­˜</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œé˜²æ­¢å†…å®¹ä¸¢å¤±</p>
                </div>
                
                <div style="background: #f5f5f7; padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center;">
                    <h3 style="color: #1d1d1f; margin: 0 0 8px 0; font-size: 16px;">ğŸ‘¨â€ğŸ’» ä½œè€…ä¿¡æ¯</h3>
                    <p style="color: #86868b; margin: 0; font-size: 14px;">pHotter Song</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="document.querySelector('.modal').remove()" style="
                        background: #007aff;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        font-size: 16px;
                        cursor: pointer;
                        font-weight: 500;
                    ">å…³é—­</button>
                </div>
            `;
            
            modal.appendChild(content);
            modal.className = 'modal';
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }

        // æ‰“å°é¢„è§ˆå‡½æ•° - ä¼˜åŒ–iOS Safariå…¼å®¹æ€§
        function printPreview() {
            try {
                const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                
                // æ£€æŸ¥é¢„è§ˆå†…å®¹æ˜¯å¦ä¸ºç©º
                if (!previewDoc.body || !previewDoc.body.innerHTML.trim()) {
                    showToast('é¢„è§ˆå†…å®¹ä¸ºç©ºï¼Œè¯·å…ˆè¾“å…¥ä¸€äº›å†…å®¹', 'error');
                    return;
                }

                // iOS Safariç‰¹æ®Šå¤„ç†
                if (isIOS()) {
                    // åœ¨iOS Safariä¸­ï¼Œç›´æ¥åœ¨å½“å‰çª—å£æ‰“å°é¢„è§ˆå†…å®¹
                    printCurrentPreview();
                    return;
                }

                // åˆ›å»ºæ‰“å°æ ·å¼
                const style = document.createElement('style');
                style.textContent = `
                    @media print {
                        @page { margin: 1cm; }
                        body { 
                            margin: 0;
                            padding: 0;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                        }
                        * { 
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                    }
                `;

                // åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰“å°çª—å£
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    showToast('æ— æ³•æ‰“å¼€æ‰“å°çª—å£ï¼Œè¯·æ£€æŸ¥æ˜¯å¦è¢«æµè§ˆå™¨é˜»æ­¢', 'error');
                    return;
                }

                // å¤åˆ¶æ‰€æœ‰åŸå§‹æ ·å¼è¡¨
                const styleSheets = Array.from(previewDoc.styleSheets);
                const styleLinks = styleSheets.map(sheet => {
                    if (sheet.href) {
                        return `<link rel="stylesheet" href="${sheet.href}">`;
                    } else if (sheet.ownerNode && sheet.ownerNode.textContent) {
                        return `<style>${sheet.ownerNode.textContent}</style>`;
                    }
                    return '';
                }).join('');

                // æ„å»ºæ‰“å°é¡µé¢
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>æ‰“å°é¢„è§ˆ</title>
                        ${styleLinks}
                        ${style.outerHTML}
                    </head>
                    <body>
                        ${previewDoc.body.innerHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();

                // ç­‰å¾…èµ„æºåŠ è½½å®Œæˆåæ‰“å°
                if (printWindow.document.readyState === 'complete') {
                    printWindow.print();
                } else {
                    printWindow.addEventListener('load', function() {
                        printWindow.print();
                    });
                }

                // æ‰“å°å®Œæˆåå…³é—­çª—å£
                const checkPrintCompletion = setInterval(() => {
                    if (!printWindow || printWindow.closed) {
                        clearInterval(checkPrintCompletion);
                    }
                }, 1000);

                showToast('æ­£åœ¨æ‰“å¼€æ‰“å°é¢„è§ˆ...', 'success');
            } catch (error) {
                console.error('æ‰“å°å‡ºé”™:', error);
                showToast('æ‰“å°åŠŸèƒ½å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // iOS Safariä¸“ç”¨æ‰“å°å‡½æ•°
        function printCurrentPreview() {
            try {
                const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                
                // åˆ›å»ºä¸´æ—¶æ‰“å°æ ·å¼
                const printStyle = document.createElement('style');
                printStyle.textContent = `
                    @media print {
                        @page { margin: 1cm; }
                        body { 
                            margin: 0;
                            padding: 0;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                        }
                        * { 
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                    }
                `;
                
                // å°†æ‰“å°æ ·å¼æ·»åŠ åˆ°é¢„è§ˆæ–‡æ¡£
                previewDoc.head.appendChild(printStyle);
                
                // ç›´æ¥æ‰“å°é¢„è§ˆæ¡†æ¶
                previewFrame.contentWindow.print();
                
                // å»¶è¿Ÿç§»é™¤æ‰“å°æ ·å¼
                setTimeout(() => {
                    if (printStyle.parentNode) {
                        printStyle.parentNode.removeChild(printStyle);
                    }
                }, 1000);
                
                showToast('æ­£åœ¨æ‰“å°é¢„è§ˆå†…å®¹...', 'success');
            } catch (error) {
                console.error('iOSæ‰“å°å‡ºé”™:', error);
                showToast('iOSæ‰“å°åŠŸèƒ½å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // å…¨å±é¢„è§ˆåˆ‡æ¢å‡½æ•°
        function toggleFullscreenPreview() {
            const previewPanel = document.querySelector('.preview-panel');
            
            if (previewPanel.classList.contains('fullscreen-preview')) {
                // é€€å‡ºå…¨å±
                previewPanel.classList.remove('fullscreen-preview');
                // ç§»é™¤å…³é—­æŒ‰é’®
                const closeBtn = document.querySelector('.fullscreen-close');
                if (closeBtn) {
                    closeBtn.addEventListener('transitionend', function() {
                        document.body.removeChild(closeBtn);
                    });
                    closeBtn.style.opacity = '0';
                }
            } else {
                // è¿›å…¥å…¨å±
                previewPanel.classList.add('fullscreen-preview');
                // æ·»åŠ å…³é—­æŒ‰é’®
                const closeBtn = document.createElement('button');
                closeBtn.className = 'fullscreen-close';
                closeBtn.onclick = toggleFullscreenPreview;
                closeBtn.title = 'é€€å‡ºå…¨å±';
                document.body.appendChild(closeBtn);
                // å»¶è¿Ÿæ˜¾ç¤ºå…³é—­æŒ‰é’®ä»¥å®ç°æ·¡å…¥æ•ˆæœ
                requestAnimationFrame(() => closeBtn.style.opacity = '0.3');
            }
            
            // å»¶è¿Ÿåˆ·æ–°é¢„è§ˆä»¥ç¡®ä¿æ­£ç¡®æ¸²æŸ“
            setTimeout(() => {
                refreshPreview();
            }, 100);
        }

        // iOSå…¼å®¹æ€§æ£€æµ‹å’Œé”™è¯¯å¤„ç†
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }
        
        function isIOSSafari() {
            return isIOS() && /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/CriOS/.test(navigator.userAgent);
        }
        
        function isIOSEdge() {
            return isIOS() && /EdgiOS|Edge/.test(navigator.userAgent);
        }
        
        // å¢å¼ºçš„iOSé”™è¯¯å¤„ç†
        function handleIOSError(operation, error) {
            console.warn(`iOS ${operation} é”™è¯¯:`, error);
            
            if (isIOSSafari()) {
                showToast('iOS Safariå…¼å®¹æ€§æç¤ºï¼šå¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·å°è¯•åŒå‡»è¾“å…¥åŒºåŸŸ', 'warning');
            } else if (isIOSEdge()) {
                showToast('iOS Edgeå…¼å®¹æ€§æç¤ºï¼šåŠŸèƒ½å¯èƒ½å—é™ï¼Œå»ºè®®ä½¿ç”¨Safari', 'warning');
            }
        }
        
        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            try {
                const stored = localStorage.getItem(HISTORY_STORAGE_KEY);
                if (stored) {
                    historyRecords = JSON.parse(stored);
                }
            } catch (error) {
                console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                historyRecords = [];
            }
        }
        
        // ä¿å­˜å†å²è®°å½•åˆ°localStorage
        function saveHistory() {
            try {
                localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(historyRecords));
            } catch (error) {
                console.error('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
            }
        }
        
        // æ·»åŠ å½“å‰ä»£ç åˆ°å†å²è®°å½•
        function addToHistory() {
            const code = htmlEditor.value.trim();
            if (!code) return;
            
            // æ£€æŸ¥æ˜¯å¦ä¸æœ€è¿‘ä¸€æ¡è®°å½•ç›¸åŒ
            if (historyRecords.length > 0 && historyRecords[0].content === code) {
                return;
            }
            
            // åˆ›å»ºæ–°çš„å†å²è®°å½•
            const record = {
                id: Date.now(),
                content: code,
                timestamp: new Date().toISOString(),
                preview: code.substring(0, 100) + (code.length > 100 ? '...' : '')
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•å¼€å¤´
            historyRecords.unshift(record);
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (historyRecords.length > MAX_HISTORY_RECORDS) {
                historyRecords = historyRecords.slice(0, MAX_HISTORY_RECORDS);
            }
            
            // ä¿å­˜åˆ°localStorage
            saveHistory();
            
            // å¦‚æœå†å²é¢æ¿å·²æ‰“å¼€ï¼Œæ›´æ–°æ˜¾ç¤º
            if (historyPanel.classList.contains('show')) {
                displayHistory();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶å°è¯•æ¢å¤ä¿å­˜çš„å†…å®¹
        window.addEventListener('load', function() {
            try {
                // åŠ è½½è®¾ç½®
                loadSettings();
                
                // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰åˆ†äº«é“¾æ¥å‚æ•°
                loadFromShareUrl();
                
                // å¦‚æœæ²¡æœ‰åˆ†äº«å†…å®¹ï¼Œå†ä»localStorageåŠ è½½
                if (!htmlEditor.value.trim()) {
                    loadFromLocalStorage();
                }
                
                loadHistory();
                
                // iOSè®¾å¤‡ç‰¹æ®Šå¤„ç†
                if (isIOS()) {
                    // å»¶è¿Ÿåˆå§‹åŒ–ç¡®ä¿iOSå®Œå…¨åŠ è½½
                    setTimeout(function() {
                        htmlEditor.focus();
                        htmlEditor.blur();
                    }, 500);
                    
                    console.log('æ£€æµ‹åˆ°iOSè®¾å¤‡ï¼Œå·²åº”ç”¨å…¼å®¹æ€§ä¼˜åŒ–');
                }
                
                console.log('HTMLç¼–è¾‘å™¨å·²åŠ è½½ï¼Œå†å²è®°å½•åŠŸèƒ½å·²åˆå§‹åŒ–');
                console.log('å½“å‰å†å²è®°å½•æ•°é‡:', historyRecords.length);
                console.log('åˆ†äº«åŸºç¡€URL:', shareBaseUrl || 'ä½¿ç”¨å½“å‰é¡µé¢URL');
            } catch (error) {
                handleIOSError('é¡µé¢åŠ è½½', error);
            }
        });
        
        // æµ‹è¯•å†å²è®°å½•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
        function testHistory() {
            console.log('=== æµ‹è¯•å†å²è®°å½•åŠŸèƒ½ ===');
            
            // æµ‹è¯•æ·»åŠ åˆ°å†å²è®°å½•
            htmlEditor.value = '<h1>æµ‹è¯•å†å²è®°å½• 1</h1>';
            addToHistory();
            console.log('æ·»åŠ ç¬¬ä¸€æ¡å†å²è®°å½•åæ•°é‡:', historyRecords.length);
            
            htmlEditor.value = '<h1>æµ‹è¯•å†å²è®°å½• 2</h1>';
            addToHistory();
            console.log('æ·»åŠ ç¬¬äºŒæ¡å†å²è®°å½•åæ•°é‡:', historyRecords.length);
            
            // æµ‹è¯•æ˜¾ç¤ºå†å²è®°å½•
            displayHistory();
            
            console.log('=== å†å²è®°å½•æµ‹è¯•å®Œæˆ ===');
        }
        
        // æµ‹è¯•åˆ†äº«åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
        function testShare() {
            console.log('=== æµ‹è¯•åˆ†äº«åŠŸèƒ½ ===');
            
            // æµ‹è¯•1ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥
            htmlEditor.value = '<h1>æµ‹è¯•åˆ†äº«åŠŸèƒ½</h1><p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ†äº«çš„å†…å®¹</p>';
            generateShareLink();
            console.log('åˆ†äº«é“¾æ¥å·²ç”Ÿæˆ:', shareLink.value);
            
            // æµ‹è¯•2ï¼šéªŒè¯é“¾æ¥æ˜¯å¦åŒ…å«å†…å®¹
            const hasContent = shareLink.value.includes(SHARE_PARAM_NAME);
            console.log('åˆ†äº«é“¾æ¥åŒ…å«å†…å®¹å‚æ•°:', hasContent);
            
            // æµ‹è¯•3ï¼šæ¨¡æ‹Ÿä»åˆ†äº«é“¾æ¥åŠ è½½
            const testUrl = new URL(shareLink.value);
            const encodedContent = testUrl.searchParams.get(SHARE_PARAM_NAME);
            const decodedContent = decodeURIComponent(atob(encodedContent));
            console.log('è§£ç åçš„å†…å®¹:', decodedContent);
            console.log('è§£ç å†…å®¹ä¸åŸå†…å®¹åŒ¹é…:', decodedContent === htmlEditor.value);
            
            console.log('=== åˆ†äº«åŠŸèƒ½æµ‹è¯•å®Œæˆ ===');
        }
        
        // å¿«æ·é”®æ”¯æŒï¼šCtrl+H æ‰“å¼€å†å²è®°å½•
        htmlEditor.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                toggleHistoryPanel();
            }
            // Ctrl+Shift+S æ‰“å¼€åˆ†äº«é¢æ¿
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 's') {
                e.preventDefault();
                toggleSharePanel();
            }
        });
        
        // åˆ‡æ¢åˆ†äº«é¢æ¿æ˜¾ç¤º/éšè—
        function toggleSharePanel() {
            sharePanel.classList.toggle('show');
            if (sharePanel.classList.contains('show')) {
                generateShareLink();
            }
        }
        
        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateShareLink() {
            const content = htmlEditor.value;
            if (!content.trim()) {
                showToast('è¯·å…ˆè¾“å…¥å†…å®¹å†ç”Ÿæˆåˆ†äº«é“¾æ¥', 'error');
                return;
            }
            
            try {
                // å°†å†…å®¹ç¼–ç ä¸ºBase64
                const encodedContent = btoa(encodeURIComponent(content));
                let url;
                
                // ä½¿ç”¨è‡ªå®šä¹‰åˆ†äº«åŸºç¡€URLæˆ–å½“å‰é¡µé¢URL
                if (shareBaseUrl) {
                    url = new URL(shareBaseUrl);
                } else {
                    url = new URL(window.location.href);
                }
                
                // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§å†…å®¹å‚æ•°
                url.searchParams.delete(SHARE_PARAM_NAME);
                // æ·»åŠ æ–°çš„å†…å®¹å‚æ•°
                url.searchParams.append(SHARE_PARAM_NAME, encodedContent);
                
                // æ›´æ–°åˆ†äº«é“¾æ¥è¾“å…¥æ¡†
                shareLink.value = url.toString();
                showToast('åˆ†äº«é“¾æ¥å·²ç”Ÿæˆ', 'success');
            } catch (error) {
                console.error('ç”Ÿæˆåˆ†äº«é“¾æ¥å¤±è´¥:', error);
                showToast('ç”Ÿæˆåˆ†äº«é“¾æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæ ¼å¼', 'error');
            }
        }
        
        // å¤åˆ¶åˆ†äº«é“¾æ¥åˆ°å‰ªè´´æ¿
        function copyShareLink() {
            const link = shareLink.value;
            if (!link) {
                showToast('è¯·å…ˆç”Ÿæˆåˆ†äº«é“¾æ¥', 'error');
                return;
            }
            
            try {
                // ä½¿ç”¨Clipboard APIå¤åˆ¶é“¾æ¥
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(link).then(() => {
                        showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    }).catch(() => {
                        fallbackCopyShareLink(link);
                    });
                } else {
                    fallbackCopyShareLink(link);
                }
            } catch (error) {
                console.error('å¤åˆ¶é“¾æ¥å¤±è´¥:', error);
                fallbackCopyShareLink(link);
            }
        }
        
        // å¤åˆ¶é“¾æ¥çš„é™çº§æ–¹æ¡ˆ
        function fallbackCopyShareLink(link) {
            try {
                // åˆ›å»ºä¸´æ—¶textareaå…ƒç´ 
                const textArea = document.createElement('textarea');
                textArea.value = link;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                // æ‰§è¡Œå¤åˆ¶å‘½ä»¤
                const success = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (success) {
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } else {
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                }
            } catch (error) {
                console.error('é™çº§å¤åˆ¶æ–¹æ¡ˆå¤±è´¥:', error);
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            }
        }
        
        // åœ¨æ–°çª—å£æ‰“å¼€åˆ†äº«é“¾æ¥
        function openShareLink() {
            const link = shareLink.value;
            if (!link) {
                showToast('è¯·å…ˆç”Ÿæˆåˆ†äº«é“¾æ¥', 'error');
                return;
            }
            
            try {
                window.open(link, '_blank');
                showToast('åˆ†äº«é“¾æ¥å·²åœ¨æ–°çª—å£æ‰“å¼€', 'success');
            } catch (error) {
                console.error('æ‰“å¼€åˆ†äº«é“¾æ¥å¤±è´¥:', error);
                showToast('æ‰“å¼€åˆ†äº«é“¾æ¥å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰“å¼€', 'error');
            }
        }
        
        // ä»URLå‚æ•°åŠ è½½åˆ†äº«å†…å®¹
        function loadFromShareUrl() {
            try {
                const url = new URL(window.location.href);
                const encodedContent = url.searchParams.get(SHARE_PARAM_NAME);
                
                if (encodedContent) {
                    // è§£ç å†…å®¹
                    const content = decodeURIComponent(atob(encodedContent));
                    htmlEditor.value = content;
                    updatePreview();
                    updateCharCount();
                    showToast('å·²åŠ è½½åˆ†äº«å†…å®¹', 'success');
                    console.log('ä»åˆ†äº«é“¾æ¥åŠ è½½å†…å®¹æˆåŠŸ');
                }
            } catch (error) {
                console.error('ä»åˆ†äº«é“¾æ¥åŠ è½½å†…å®¹å¤±è´¥:', error);
                showToast('åˆ†äº«é“¾æ¥æ— æ•ˆæˆ–å·²æŸå', 'error');
            }
        }
        
        // åˆ‡æ¢è®¾ç½®é¢æ¿æ˜¾ç¤º/éšè—
        function toggleSettingsPanel() {
            settingsPanel.classList.toggle('show');
            if (settingsPanel.classList.contains('show')) {
                loadSettings();
            }
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            try {
                const stored = localStorage.getItem(SETTINGS_STORAGE_KEY);
                if (stored) {
                    const settings = JSON.parse(stored);
                    
                    // åº”ç”¨è®¾ç½®
                    if (settings.shareBaseUrl) {
                        shareBaseUrl = settings.shareBaseUrl;
                        shareBaseUrlInput.value = settings.shareBaseUrl;
                    }
                    
                    if (settings.autoSaveInterval) {
                        autoSaveInterval = settings.autoSaveInterval;
                        autoSaveIntervalInput.value = settings.autoSaveInterval;
                    }
                    
                    if (settings.maxHistoryRecords) {
                        MAX_HISTORY_RECORDS = settings.maxHistoryRecords;
                        maxHistoryRecordsInput.value = settings.maxHistoryRecords;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                showToast('åŠ è½½è®¾ç½®å¤±è´¥', 'error');
            }
        }
        
        // ä¿å­˜è®¾ç½®åˆ°localStorage
        function saveSettings(settings) {
            try {
                const currentSettings = JSON.parse(localStorage.getItem(SETTINGS_STORAGE_KEY) || '{}');
                const updatedSettings = { ...currentSettings, ...settings };
                localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(updatedSettings));
                showToast('è®¾ç½®å·²ä¿å­˜', 'success');
                return true;
            } catch (error) {
                console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', error);
                showToast('ä¿å­˜è®¾ç½®å¤±è´¥', 'error');
                return false;
            }
        }
        
        // ä¿å­˜åˆ†äº«åŸºç¡€URL
        function saveShareBaseUrl() {
            const url = shareBaseUrlInput.value.trim();
            shareBaseUrl = url;
            saveSettings({ shareBaseUrl: url });
        }
        
        // é‡ç½®åˆ†äº«åŸºç¡€URL
        function resetShareBaseUrl() {
            shareBaseUrl = '';
            shareBaseUrlInput.value = '';
            saveSettings({ shareBaseUrl: '' });
        }
        
        // ä¿å­˜è‡ªåŠ¨ä¿å­˜é—´éš”
        function saveAutoSaveInterval() {
            const interval = parseInt(autoSaveIntervalInput.value);
            if (isNaN(interval) || interval < 1 || interval > 600) {
                showToast('è¯·è¾“å…¥1-600ä¹‹é—´çš„æ•°å€¼', 'error');
                return;
            }
            autoSaveInterval = interval;
            saveSettings({ autoSaveInterval: interval });
        }
        
        // ä¿å­˜æœ€å¤§å†å²è®°å½•æ•°
        function saveMaxHistoryRecords() {
            const maxRecords = parseInt(maxHistoryRecordsInput.value);
            if (isNaN(maxRecords) || maxRecords < 1 || maxRecords > 50) {
                showToast('è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å€¼', 'error');
                return;
            }
            MAX_HISTORY_RECORDS = maxRecords;
            saveSettings({ maxHistoryRecords: maxRecords });
            // å¦‚æœå½“å‰å†å²è®°å½•è¶…è¿‡æ–°çš„æœ€å¤§å€¼ï¼Œè£å‰ªå†å²è®°å½•
            if (historyRecords.length > MAX_HISTORY_RECORDS) {
                historyRecords = historyRecords.slice(0, MAX_HISTORY_RECORDS);
                saveHistory();
            }
        }
        
        // åº”ç”¨æ‰€æœ‰è®¾ç½®
        function applyAllSettings() {
            saveShareBaseUrl();
            saveAutoSaveInterval();
            saveMaxHistoryRecords();
            showToast('æ‰€æœ‰è®¾ç½®å·²åº”ç”¨', 'success');
        }
        
        // è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿å¯è®¿é—®é“¾æ¥
        async function generateOnlineLink() {
            const content = htmlEditor.value;
            if (!content.trim()) {
                showToast('è¯·å…ˆè¾“å…¥å†…å®¹å†ç”Ÿæˆåœ¨çº¿é“¾æ¥', 'error');
                return;
            }
            
            try {
                showToast('æ­£åœ¨ç”Ÿæˆåœ¨çº¿é“¾æ¥...', 'success');
                
                // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
                const fileName = `html-editor-${Date.now()}.html`;
                
                // å°è¯•ä½¿ç”¨GitHub Gist API
                try {
                    console.log('å°è¯•ä½¿ç”¨GitHub Gist APIç”Ÿæˆåœ¨çº¿é“¾æ¥...');
                    const gistResponse = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            description: 'HTML Editor Online Share',
                            public: true,
                            files: {
                                [fileName]: {
                                    content: content
                                }
                            }
                        })
                    });
                    
                    if (!gistResponse.ok) {
                        throw new Error('GitHub Gist APIé”™è¯¯: ' + gistResponse.status + ' ' + gistResponse.statusText);
                    }
                    
                    const gistData = await gistResponse.json();
                    
                    // ç”Ÿæˆå¯è®¿é—®çš„HTMLé“¾æ¥
                    const rawUrl = gistData.files[fileName].raw_url;
                    const onlineLink = `https://htmlpreview.github.io/?${rawUrl}`;
                    
                    // æ›´æ–°åˆ†äº«é“¾æ¥è¾“å…¥æ¡†
                    shareLink.value = onlineLink;
                    showToast('åœ¨çº¿é“¾æ¥å·²ç”Ÿæˆ', 'success');
                    
                    // è‡ªåŠ¨å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                    await navigator.clipboard.writeText(onlineLink);
                    showToast('åœ¨çº¿é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    
                    console.log('ç”Ÿæˆçš„åœ¨çº¿é“¾æ¥:', onlineLink);
                    console.log('GitHub Gist URL:', gistData.html_url);
                    console.log('Raw file URL:', rawUrl);
                    return;
                    
                } catch (gistError) {
                    console.error('GitHub Gist APIå¤±è´¥:', gistError);
                    showToast('GitHub Gistç”Ÿæˆå¤±è´¥ï¼Œå°è¯•å¤‡é€‰æ–¹æ¡ˆ...', 'warning');
                }
                
                // å¦‚æœGitHub Gistå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å…¶ä»–æœåŠ¡
                await generateAlternativeOnlineLink(content);
                
            } catch (error) {
                console.error('ç”Ÿæˆåœ¨çº¿é“¾æ¥å¤±è´¥:', error);
                showToast('ç”Ÿæˆåœ¨çº¿é“¾æ¥å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // å¤‡é€‰åœ¨çº¿é“¾æ¥ç”Ÿæˆï¼ˆä½¿ç”¨å¦ä¸€ä¸ªæœåŠ¡ï¼‰
        async function generateAlternativeOnlineLink(content) {
            try {
                console.log('å°è¯•ä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆç”Ÿæˆåœ¨çº¿é“¾æ¥...');
                
                // æ–¹æ¡ˆ1ï¼šç”Ÿæˆå¯ç›´æ¥è®¿é—®çš„HTMLæ•°æ®URL
                try {
                    const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(content)}`;
                    
                    // æ£€æŸ¥æ•°æ®URLé•¿åº¦æ˜¯å¦è¶…è¿‡æµè§ˆå™¨é™åˆ¶
                    if (dataUrl.length < 1000000) { // é™åˆ¶åœ¨1MBä»¥å†…
                        shareLink.value = dataUrl;
                        showToast('å·²ç”Ÿæˆæ•°æ®URLé“¾æ¥', 'success');
                        
                        // è‡ªåŠ¨å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                        await navigator.clipboard.writeText(dataUrl);
                        showToast('æ•°æ®URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                        return;
                    }
                    console.log('æ•°æ®URLå¤ªé•¿ï¼Œå°è¯•å…¶ä»–æ–¹æ¡ˆ...');
                } catch (dataUrlError) {
                    console.error('æ•°æ®URLç”Ÿæˆå¤±è´¥:', dataUrlError);
                }
                
                // æ–¹æ¡ˆ2ï¼šç”ŸæˆåŸºäºBase64çš„è‡ªåŒ…å«é“¾æ¥ï¼ˆå¢å¼ºç‰ˆï¼‰
                try {
                    const encodedContent = btoa(encodeURIComponent(content));
                    
                    // æä¾›ä¸åŒçš„è®¿é—®æ–¹å¼
                    const selfContainedLink = `${window.location.origin}${window.location.pathname}?${SHARE_PARAM_NAME}=${encodedContent}`;
                    
                    shareLink.value = selfContainedLink;
                    showToast('å·²ç”Ÿæˆè‡ªåŒ…å«åœ¨çº¿é“¾æ¥', 'success');
                    
                    // è‡ªåŠ¨å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
                    await navigator.clipboard.writeText(selfContainedLink);
                    showToast('è‡ªåŒ…å«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    
                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    setTimeout(() => {
                        showToast('æç¤ºï¼šå¦‚æœé“¾æ¥æ— æ³•è®¿é—®ï¼Œè¯·ç¡®ä¿ç¼–è¾‘å™¨é¡µé¢å·²åœ¨å…¬ç½‘éƒ¨ç½²', 'info');
                    }, 2000);
                    
                    return;
                } catch (selfContainedError) {
                    console.error('è‡ªåŒ…å«é“¾æ¥ç”Ÿæˆå¤±è´¥:', selfContainedError);
                }
                
                // æ‰€æœ‰æ–¹æ¡ˆéƒ½å¤±è´¥æ—¶
                throw new Error('æ‰€æœ‰åœ¨çº¿é“¾æ¥ç”Ÿæˆæ–¹æ¡ˆå‡å¤±è´¥');
                
            } catch (error) {
                console.error('å¤‡é€‰åœ¨çº¿é“¾æ¥ç”Ÿæˆå¤±è´¥:', error);
                
                // æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯æç¤ºå’Œè§£å†³æ–¹æ¡ˆ
                showToast('ç”Ÿæˆåœ¨çº¿é“¾æ¥å¤±è´¥', 'error');
                
                // æ˜¾ç¤ºæ‰‹åŠ¨è§£å†³æ–¹æ¡ˆ
                setTimeout(() => {
                    showToast('å»ºè®®ï¼š1. æ‰‹åŠ¨éƒ¨ç½²ç¼–è¾‘å™¨åˆ°å…¬ç½‘ 2. ä½¿ç”¨è®¾ç½®é¢æ¿é…ç½®åˆ†äº«åŸºç¡€URL', 'info');
                }, 2000);
                
                // æ˜¾ç¤ºæœ¬åœ°æœåŠ¡å™¨å¯åŠ¨æç¤º
                setTimeout(() => {
                    showToast('æœ¬åœ°æµ‹è¯•ï¼šå¯ä½¿ç”¨ python -m http.server 8000 å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨', 'info');
                }, 4000);
            }
        }
        
        // iOS Safari/Edge å…¼å®¹æ€§ï¼šå¢å¼ºè§¦æ‘¸äº‹ä»¶å¤„ç†
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            [clearBtn, pasteBtn, downloadBtn, fullscreenBtn, printBtn, openBtn].forEach(function(btn) {
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.style.opacity = '0.7';
                    this.style.transform = 'scale(0.98)';
                });
                
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.style.opacity = '';
                    this.style.transform = '';
                    
                    // å»¶è¿Ÿæ‰§è¡Œç‚¹å‡»åŠŸèƒ½ï¼Œç¡®ä¿è§¦æ‘¸äº‹ä»¶å®Œå…¨å¤„ç†
                    setTimeout(() => {
                        if (this.id === 'clearBtn') {
                            clearEditor();
                        } else if (this.id === 'pasteBtn') {
                            pasteFromClipboard();
                        } else if (this.id === 'downloadBtn') {
                            downloadHTML();
                        } else if (this.id === 'fullscreenBtn') {
                            toggleFullscreenPreview();
                        } else if (this.id === 'printBtn') {
                            printPreview();
                        } else if (this.id === 'openBtn') {
                            openLocalFile();
                        }
                    }, 50);
                });
                
                btn.addEventListener('touchcancel', function(e) {
                    this.style.opacity = '';
                    this.style.transform = '';
                });
            });
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // é˜²æ­¢é¡µé¢ç¼©æ”¾
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
        }
    </script>
</body>
</html>